# AutoLang Architecture Clarification

## Overview

AutoLang has **ONE canonical compiler implementation**: the Rust implementation located in `crates/` directory.

Previous documentation incorrectly referenced multiple compiler implementations (C, Rust, self-hosted). This document clarifies the actual architecture.

## Compiler Architecture

### Primary Implementation: Rust Compiler (`crates/`)

The AutoLang compiler is implemented in Rust and located in `crates/auto-lang/`. It supports three execution modes:

1. **Evaluator** (`eval.rs`): Interprets AutoLang code directly
   - Supports REPL (Read-Eval-Print Loop)
   - Executes `.at` files as scripts
   - Used for configuration and templating

2. **C Transpiler** (`trans/c.rs`): Transpiles AutoLang to C
   - Generates C code for embedded systems
   - Test framework: `crates/auto-lang/test/a2c/`
   - Provides low-level access and minimal footprint

3. **Rust Transpiler** (`trans/rust.rs`): Transpiles AutoLang to Rust
   - Generates Rust code for native applications
   - Test framework: `crates/auto-lang/test/a2r/`
   - Leverages Rust's performance and safety

### Compilation Pipeline

```
Source Code (.at files)
    ↓
Lexer (lexer.rs) → Tokens
    ↓
Parser (parser.rs) → AST (ast.rs)
    ↓
├─→ Evaluator (eval.rs) → Value (REPL/execution)
├─→ C Transpiler (trans/c.rs) → C code
└─→ Rust Transpiler (trans/rust.rs) → Rust code
```

## Directory Structure

### Compiler Implementation
- `crates/auto-lang/` - Main AutoLang compiler (Rust)
- `crates/auto-val/` - Value system and data structures (Rust)
- `crates/auto-lang/src/trans/` - Transpilers (c.rs, rust.rs)

### Test Frameworks
- `crates/auto-lang/test/a2c/` - Auto-to-C transpiler tests
- `crates/auto-lang/test/a2r/` - Auto-to-Rust transpiler tests

### Self-Hosted Compiler (Future)
- `auto/` - AutoLang compiler written in AutoLang itself
- **Status**: Early stage, not yet functional
- **Goal**: Bootstrap the compiler to compile itself

### Standard Library
- `stdlib/auto/` - AutoLang standard library (.at files)
- Generated C headers in `stdlib/auto/` are auto-generated by a2c transpiler

## Build Commands

```bash
# Build the compiler
cargo build --release

# Run REPL
cargo run --release

# Run tests
cargo test -p auto-lang

# Run transpiler tests
cargo test -p auto-lang -- trans

# Transpile AutoLang to C
cargo run --release -- c input.at

# Transpile AutoLang to Rust
cargo run --release -- rust input.at
```

## Key Clarifications

### ❌ Incorrect: Multiple Compiler Implementations
Previous documentation suggested:
- C version (`autoc/`) - embedded-friendly port
- Rust version (`crates/`) - reference implementation
- Self-hosted version (`auto/`) - bootstrap effort

### ✅ Correct: Single Compiler with Multiple Backends
- **ONE compiler**: Rust implementation in `crates/`
- **THREE backends**: Evaluator, C transpiler, Rust transpiler
- **Future work**: Self-hosted compiler in `auto/`

### Removed Directories
- `autoc/` - Was AI-generated test files, not a real C compiler implementation
- The actual C transpiler is in `crates/auto-lang/src/trans/c.rs`

## Type Composition System

The AutoLang type composition system (`has` keyword) has been significantly improved:

### Phase 1: Method Composition (Completed)
- Methods from composed types are mixed into deriving types
- Runtime method resolution via `TypeName::method_name`
- Trait generation for composed types in Rust transpiler

### Phase 2: Field Composition (Completed)
- Fields from composed types are mixed into deriving types
- Field defaults applied during instantiation
- Duplicate field name prevention with HashSet

Test coverage:
- `test/a2r/029_composition/` - Basic method composition
- `test/a2r/030_field_composition/` - Field composition
- `test/a2r/031_spec/` - Spec trait composition
- `test/a2r/032_delegation/` - Delegation pattern
- `test/a2r/033_multi_delegation/` - Multiple composition
- `test/a2r/034_delegation_params/` - Delegation with parameters

All 366 tests passing.

## Future Work

### Self-Hosted Compiler (`auto/`)
- Implement AutoLang compiler in AutoLang itself
- Bootstrap the compiler to compile itself
- Create a self-sustaining ecosystem

### Enhanced Type System
- Generic type parameters
- Trait/interface system
- Advanced type inference

## Summary

AutoLang has a single, well-architected compiler implementation in Rust that supports multiple execution modes. The compiler can interpret code directly or transpile it to C or Rust based on the target use case. This design provides flexibility while maintaining a single source of truth for language semantics.
