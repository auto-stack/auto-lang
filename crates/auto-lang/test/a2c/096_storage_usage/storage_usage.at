// Test Plan 052: Storage usage with method calls

spec Storage<T> {
    fn data() *T
    fn capacity() u32
    fn try_grow(min_cap u32) bool
}

type Heap<T> as Storage<T> {
    ptr *T
    cap u32
}

type InlineInt64 as Storage<int> {
    buffer [64]int
}

ext Heap {
    #[c]
    static fn new() Heap {
        return Heap(ptr: 0 as *void, cap: 0)
    }

    #[c]
    fn data() *void {
        return .ptr
    }

    #[c]
    fn capacity() u32 {
        return .cap
    }

    #[c]
    fn try_grow(min_cap u32) bool {
        return .cap >= min_cap
    }
}

ext InlineInt64 {
    #[c]
    static fn new() InlineInt64 {
        return InlineInt64(buffer: [0])
    }

    #[c]
    fn data() *int {
        return .buffer.ptr
    }

    #[c]
    fn capacity() u32 {
        return 64
    }

    #[c]
    fn try_grow(min_cap u32) bool {
        return min_cap <= 64
    }
}

fn main() {
    // Create heap storage
    let heap = Heap.new()
    let heap_data = heap.data()
    let heap_cap = heap.capacity()
    let can_grow_heap = heap.try_grow(100)

    // Create inline storage
    let inline = InlineInt64.new()
    let inline_data = inline.data()
    let inline_cap = inline.capacity()
    let can_grow_inline = inline.try_grow(50)

    return 0
}
